<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPDWCA Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="./index.css">
</head>
<script type="text/javascript" >
var compteur =1;
var bublecompteur =1;
var maphrase = "";
var bublearray = [];
var items = ["BlaBlaBla, tu comprends ?", "BlaBlaBla, t'étais ou?", "BlaBlaBla, tu as fait quoi ?", "BlaBlaBla, tu sais ou pas ?"]


function virtualtalk(){
  var aujourdhui = new Date();
  var mybulle = document.createElement("div");
  var monserver = document.createElement("div");
  var mynom = document.createElement("p");
  var myheure = document.createElement("p");
  var mymessage = document.createElement("p");
  mybulle.setAttribute("id", "mybuble"+compteur);
  mybulle.classList.add("msg-container");
  monserver.setAttribute("id", "myserver"+compteur);
  monserver.classList.add("msg-header");
  mynom.setAttribute("id", "myname"+compteur);
  mynom.classList.add("fw-bold");
  mynom.innerHTML="Kevin";
  myheure.setAttribute("id", "mytiming"+compteur);
  myheure.innerHTML=aujourdhui.getHours()+":"+aujourdhui.getMinutes();
  myheure.classList.add("text-light");
  mymessage.setAttribute("id", "mytext"+compteur);
  mymessage.classList.add('msg-text');
  var virtualtext = items[Math.floor(Math.random() * items.length)];

  mymessage.innerHTML="" + virtualtext;
  document.getElementById("mysentence").value ="";
  document.getElementById("mychat").appendChild(mybulle);
  var txt = "mybuble"+compteur;
  var info = document.getElementById(txt);
  var infochat = document.getElementById("mychat");
  var rectchat = infochat.getBoundingClientRect();
  var rect = info.getBoundingClientRect();
  x = rect.left;
  y = rect.top;
  w = rect.width;
  h = rect.height;
  xchat = rectchat.left;
  ychat = rectchat.top;
  wchat = rectchat.width;
  hchat = rectchat.height;
  //alert ("Left: " + x + ", Top: " + y + ", Width: " + w + ", Height: " + h + "\n" + "Left: " + xchat + ", Top: " + ychat + ", Width: " + wchat + ", Height: " + hchat);
  if ((y+h) > (ychat+hchat)){
    //alert ("Ca deborde");
    var list = document.getElementById("mychat");
    list.removeChild(mychat.childNodes[0]);
    bublecompteur = bublecompteur - 1 ;
    bublearray.splice(0,1);
  }
  document.getElementById("mybuble"+compteur).appendChild(monserver);
  document.getElementById("myserver"+compteur).appendChild(mynom);
  document.getElementById("myserver"+compteur).appendChild(myheure);
  document.getElementById("mybuble"+compteur).appendChild(mymessage);
  bublearray[(bublecompteur-1)]= document.getElementById("mybuble"+compteur);
  compteur = compteur +1;
  bublecompteur = bublecompteur + 1 ;
}


function affiche(){
  var aujourdhui = new Date();
  var mybulle = document.createElement("div");
  var monserver = document.createElement("div");
  var mynom = document.createElement("p");
  var myheure = document.createElement("p");
  var mymessage = document.createElement("p");
  mybulle.setAttribute("id", "mybuble"+compteur);
  mybulle.classList.add("msg-container", "bg-primary", "align-self-end");
  monserver.setAttribute("id", "myserver"+compteur);
  monserver.classList.add("msg-header");
  mynom.setAttribute("id", "myname"+compteur);
  mynom.classList.add("text-light","fw-bold");
  mynom.innerHTML="Pedro";

  myheure.setAttribute("id", "mytiming"+compteur);
  myheure.innerHTML=aujourdhui.getHours()+":"+aujourdhui.getMinutes();
  myheure.classList.add("text-light");
  mymessage.setAttribute("id", "mytext"+compteur);
  mymessage.classList.add('msg-text');
  mymessage.innerHTML=document.getElementById("mysentence").value;
  document.getElementById("mysentence").value ="";
  document.getElementById("mychat").appendChild(mybulle);
  var txt = "mybuble"+compteur;
  var info = document.getElementById(txt);
  var infochat = document.getElementById("mychat");
  var rectchat = infochat.getBoundingClientRect();
  var rect = info.getBoundingClientRect();
  x = rect.left;
  y = rect.top;
  w = rect.width;
  h = rect.height;
  xchat = rectchat.left;
  ychat = rectchat.top;
  wchat = rectchat.width;
  hchat = rectchat.height;
  //alert ("Left: " + x + ", Top: " + y + ", Width: " + w + ", Height: " + h + "\n" + "Left: " + xchat + ", Top: " + ychat + ", Width: " + wchat + ", Height: " + hchat);
  if ((y+h) > (ychat+hchat)){
    //alert ("Ca deborde");
    var list = document.getElementById("mychat");
    list.removeChild(mychat.childNodes[0]);
    bublecompteur = bublecompteur - 1 ;
    bublearray.splice(0,1);
  }
  document.getElementById("mybuble"+compteur).appendChild(monserver);
  document.getElementById("myserver"+compteur).appendChild(mynom);
  document.getElementById("myserver"+compteur).appendChild(myheure);
  document.getElementById("mybuble"+compteur).appendChild(mymessage);
  bublearray[(bublecompteur-1)]= document.getElementById("mybuble"+compteur);
  compteur = compteur +1;
  bublecompteur = bublecompteur + 1 ;
  virtualtalk();
}

</script>

<body>
    <main>
        <div class="container bg-chat vh-85 p-4 mt-4 rounded-top d-flex flex-column" id="mychat">
           <div class="msg-container" id="mybuble">
                <div class="msg-header" id="myserver">
                    <p class="fw-bold" id="myname">Kevin</p>
                    <p id="mytiming">23:52</p>
                </div>
                <p class="msg-text" id="mytext"> Mon premier message </p>
           </div>
           <div class="msg-container bg-primary align-self-end">
            <div class="msg-header">
                <p class="text-light fw-bold">Pedro</p>
                <p class="text-light ">00:00</p>
            </div>
            <p class="msg-text text-light "> Un deuxième message
            </p>
       </div>

        </div>
        <div id="separator" class="container bg-chat"></div>
        <div id="input-send-msg" class="container bg-chat vh-5 rounded-bottom">
            <input type="text" class="form-control mr-1" id="mysentence" placeholder="Envoyer un message">
            <button type="submit" class="btn btn-primary" onclick="affiche()" >Envoyer</button>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
</body>
</html>
